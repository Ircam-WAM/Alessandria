{% extends 'alexandrie/base_tpl.html' %}

{% block title %}Lecteur{% endblock %}

{% block pageTitle %}Lecteur{% endblock %}

{% block head %}
    <link rel="stylesheet" href="/static/alexandrie/layout/jquery-datepicker/jquery.datepick.css">
{% endblock %}

{% block content %}

<div class="panel panel-primary">
    <div class="panel-heading">
        <h3 class="panel-title">{{object.get_full_name|default:"Nouveau lecteur"}}</h3>
    </div>
    <div class="panel-body">
        {% if object.id > 0 %}
        <ul class="nav nav-pills" role="tablist">
            <li role="presentation" class="active"><a href="#mainForm" aria-controls="mainForm" role="tab" data-toggle="tab">Fiche</a></li>
            <li role="presentation"><a href="#borrows" aria-controls="borrows" role="tab" data-toggle="tab">Emprunts</a></li>
        </ul>
        {% endif %}
        <div class="tab-content">
            <div role="tabpanel" class="row tab-pane active" id="mainForm">
                <div class="col-sm-12">
                    {% include 'alexandrie/_inc_form_edit_header.html' %}
                    <div class="panel panel-info">
                        <div class="panel-body">
                            <form class="form-horizontal" action="" method="post" role="form">{% csrf_token %}
                                {% include 'alexandrie/_inc_form_edit_content_std.html' %}
                                <button type="submit" class="btn btn-primary">Enregistrer</button>
                                {% if form.instance.id > 0 %}
                                    {% if not form.instance.is_disabled %}
                                        <a class="btn btn-warning" href="{% url 'alexandrie:reader_disable' form.instance.id %}">Désactiver</a>
                                    {% endif %}
                                {% endif %}
                            </form>
                        {% include 'alexandrie/_inc_form_edit_footer.html' %}
                        </div>
                    </div>
                </div>
            </div>
            {% if object.id > 0 %}
            <div role="tabpanel" class="row tab-pane" id="borrows">
                <div class="col-sm-12">
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Résumé</h3>
                        </div>
                        <div class="panel-body">
                            <dl class="dl-horizontal">
                                <dt>Nb d'emprunts:</dt><dd>{{ object.nb_borrow }}</dd>
                            </dl>
                        </div>
                    </div>
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Emprunts en cours</h3>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Date emprunt</th>
                                    <th>Livre</th>
                                    <th>Retour pour le</th>
                                </tr>
                            </thead>
                            <tbody>
                            {% for borrow in object.list_borrow_current|slice:":10" %}
                                {% if borrow.is_late %}
                                    <tr class="bg-warning">
                                {% else %}
                                    <tr>
                                {% endif %}
                                        <td><a href="{% url 'alexandrie:reader_borrow_update' borrow.id %}">{{ borrow.borrowed_date|date:"SHORT_DATE_FORMAT" }}</a></td>
                                        <td><a href="{% url 'alexandrie:book_update' borrow.bookcopy.book.id %}">{{ borrow.bookcopy.book }}</td>
                                        <td>{{ borrow.borrow_due_date|date:"SHORT_DATE_FORMAT" }}</td>
                                    </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    <div class="panel panel-default">
                        <div class="panel-heading">
                            <h3 class="panel-title">Tous les emprunts</h3>
                        </div>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Date emprunt</th>
                                    <th>Livre</th>
                                    <th>Rendu le</th>
                                </tr>
                            </thead>
                            <tbody>
                            {% for borrow in object.list_borrow_all|slice:":10" %}
                                <tr>
                                    <td><a href="{% url 'alexandrie:reader_borrow_update' borrow.id %}">{{ borrow.borrowed_date|date:"SHORT_DATE_FORMAT" }}</a></td>
                                    <td><a href="{% url 'alexandrie:book_update' borrow.bookcopy.book.id %}">{{ borrow.bookcopy.book }}</td>
                                    <td>{{ borrow.returned_on|date:"SHORT_DATE_FORMAT" }}</td>
                                </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

{% endblock %}
{% block jscript %}
<script type="text/javascript" src="/static/alexandrie/layout/jquery-ui/jquery-ui.min.js"></script>
<script type="text/javascript" src="/static/alexandrie/layout/jquery-datepicker/jquery.plugin.min.js"></script> 
<script type="text/javascript" src="/static/alexandrie/layout/jquery-datepicker/jquery.datepick.min.js"></script>
<script type="text/javascript" src="/static/alexandrie/layout/jquery-datepicker/jquery.datepick-{{ JS_DATEPICKER_LANG }}.js"></script>
<script>
$(function() {
    $('#id_inscription_date').datepick({dateFormat: 'dd/mm/yyyy'});
});
</script>
{% endblock %}